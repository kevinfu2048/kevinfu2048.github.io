
<!DOCTYPE html>
<html lang="" class="loading">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kevin-onepiece</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate">
    <meta name="keywords" content="kevin-onepiece,"> 
    <meta name="description" content="fork()vfork()execl()wait() waitpid()system()"> 
    <meta name="author" content="John Doe"> 
    <link rel="alternative" href="atom.xml" title="Kevin-onepiece" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
    <link rel="stylesheet" href="/css/diaspora.css">
</head>
</html>
<body class="loading">
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="icon-home image-icon" href="javascript:;"></a>
    <div title="播放/暂停" class="icon-play"></div>
    <h3 class="subtitle">进程环境</h3>
    <div class="social">
        <!--<div class="like-icon">-->
            <!--<a href="javascript:;" class="likeThis active"><span class="icon-like"></span><span class="count">76</span></a>-->
        <!--</div>-->
        <div>
            <div class="share">
                <a title="获取二维码" class="icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>
    <div class="section">
        <div class="article">
    <div class="main">
        <h1 class="title">进程环境</h1>
        <div class="stuff">
            <span>十一月 04, 2018</span>
            
  <ul class="post-tags-list"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/linux/">linux</a></li></ul>


        </div>
        <div class="content markdown">
            <h4 id="main-int-argc-char-argv"><a href="#main-int-argc-char-argv" class="headerlink" title="main(int argc,char *argv[])"></a>main(int argc,char *argv[])</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">#include&lt;stdio.h&gt;</span></span><br><span class="line"> <span class="comment">#include&lt;string.h&gt;</span></span><br><span class="line"> int main(int argc,char *argv[])</span><br><span class="line"> &#123;</span><br><span class="line">     int i=<span class="number">0</span>;</span><br><span class="line">     &#123;</span><br><span class="line">         printf(<span class="string">"argv[%d]=%s\n"</span>,i,argv[i]);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@vultr lesson7]<span class="comment"># gcc arg.c -o arg</span></span><br><span class="line">[root@vultr lesson7]<span class="comment"># ./arg -o 09 "test.c"</span></span><br><span class="line">argv[<span class="number">0</span>]=./arg</span><br><span class="line">argv[<span class="number">1</span>]=-o</span><br><span class="line">argv[<span class="number">2</span>]=<span class="number">09</span></span><br><span class="line">argv[<span class="number">3</span>]=test.c</span><br></pre></td></tr></table></figure>
<h4 id="getopt"><a href="#getopt" class="headerlink" title="getopt()"></a>getopt()</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include&lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">int main(int argc,char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    int c;</span><br><span class="line">    <span class="keyword">while</span>((c=getopt(argc,argv,<span class="string">"fo"</span>))!=<span class="number">-1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        switch(c)</span><br><span class="line">        &#123;</span><br><span class="line">            case <span class="string">'f'</span>:</span><br><span class="line">                printf(<span class="string">"successful read f param\n"</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            case <span class="string">'o'</span>:</span><br><span class="line">                printf(<span class="string">"successful read o param\n"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@vultr lesson7]<span class="comment"># gcc getopt.c -o getopt</span></span><br><span class="line">[root@vultr lesson7]<span class="comment"># ./getopt -f -o -i</span></span><br><span class="line">successful read f param</span><br><span class="line">successful read o param</span><br><span class="line">./getopt: invalid option -- <span class="string">'i'</span></span><br></pre></td></tr></table></figure>
<h4 id="环境变量-env-export-etc-profile"><a href="#环境变量-env-export-etc-profile" class="headerlink" title="环境变量 env() export()  /etc/profile"></a>环境变量 env() export()  /etc/profile</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include&lt;stdio.h&gt;</span></span><br><span class="line"></span><br><span class="line">int main(int argc,char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    extern char **environ;</span><br><span class="line">    char** env=environ;</span><br><span class="line">    <span class="keyword">while</span>(*env)</span><br><span class="line">    &#123;</span><br><span class="line">        printf(<span class="string">"%s\n"</span>,*env);</span><br><span class="line">        env++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@vultr lesson7]<span class="comment"># gcc environ.c -o environ</span></span><br><span class="line">[root@vultr lesson7]<span class="comment"># ./environ</span></span><br><span class="line">XDG_SESSION_ID=<span class="number">2699</span></span><br><span class="line">HOSTNAME=vultr.guest</span><br><span class="line">TERM=xterm</span><br><span class="line">SHELL=/bin/bash</span><br><span class="line">HISTSIZE=<span class="number">1000</span></span><br><span class="line">SSH_CLIENT=<span class="number">120.203</span><span class="number">.222</span><span class="number">.148</span> <span class="number">24491</span> <span class="number">22</span></span><br><span class="line">OLDPWD=/linux</span><br><span class="line">SSH_TTY=/dev/pts/<span class="number">0</span></span><br><span class="line">USER=root</span><br><span class="line">LS_COLORS=rs=<span class="number">0</span>:di=<span class="number">01</span>;<span class="number">34</span>:ln=<span class="number">01</span>;<span class="number">36</span>:mh=<span class="number">00</span>:pi=<span class="number">40</span>;<span class="number">33</span>:so=<span class="number">01</span>;<span class="number">35</span>:do=<span class="number">01</span>;<span class="number">35</span>:bd=<span class="number">40</span>;<span class="number">33</span>;<span class="number">01</span>:cd=<span class="number">40</span>;<span class="number">33</span>;<span class="number">01</span>:<span class="keyword">or</span>=<span class="number">40</span>;<span class="number">31</span>;<span class="number">01</span>:mi=<span class="number">01</span>;<span class="number">05</span>;<span class="number">37</span>;<span class="number">41</span>:su=<span class="number">37</span>;<span class="number">41</span>:sg=<span class="number">30</span>;<span class="number">43</span>:ca=<span class="number">30</span>;<span class="number">41</span>:tw=<span class="number">30</span>;<span class="number">42</span>:ow=<span class="number">34</span>;<span class="number">42</span>:st=<span class="number">37</span>;<span class="number">44</span>:ex=<span class="number">01</span>;<span class="number">32</span>:*.tar=<span class="number">01</span>;<span class="number">31</span>:*.tgz=<span class="number">01</span>;<span class="number">31</span>:*.arc=<span class="number">01</span>;<span class="number">31</span>:*.arj=<span class="number">01</span>;<span class="number">31</span>:*.taz=<span class="number">01</span>;<span class="number">31</span>:*.lha=<span class="number">01</span>;<span class="number">31</span>:*.lz4=<span class="number">01</span>;<span class="number">31</span>:*.lzh=<span class="number">01</span>;<span class="number">31</span>:*.lzma=<span class="number">01</span>;<span class="number">31</span>:*.tlz=<span class="number">01</span>;<span class="number">31</span>:*.txz=<span class="number">01</span>;<span class="number">31</span>:*.tzo=<span class="number">01</span>;<span class="number">31</span>:*.t7z=<span class="number">01</span>;<span class="number">31</span>:*.zip=<span class="number">01</span>;<span class="number">31</span>:*.z=<span class="number">01</span>;<span class="number">31</span>:*.Z=<span class="number">01</span>;<span class="number">31</span>:*.dz=<span class="number">01</span>;<span class="number">31</span>:*.gz=<span class="number">01</span>;<span class="number">31</span>:*.lrz=<span class="number">01</span>;<span class="number">31</span>:*.lz=<span class="number">01</span>;<span class="number">31</span>:*.lzo=<span class="number">01</span>;<span class="number">31</span>:*.xz=<span class="number">01</span>;<span class="number">31</span>:*.bz2=<span class="number">01</span>;<span class="number">31</span>:*.bz=<span class="number">01</span>;<span class="number">31</span>:*.tbz=<span class="number">01</span>;<span class="number">31</span>:*.tbz2=<span class="number">01</span>;<span class="number">31</span>:*.tz=<span class="number">01</span>;<span class="number">31</span>:*.deb=<span class="number">01</span>;<span class="number">31</span>:*.rpm=<span class="number">01</span>;<span class="number">31</span>:*.jar=<span class="number">01</span>;<span class="number">31</span>:*.war=<span class="number">01</span>;<span class="number">31</span>:*.ear=<span class="number">01</span>;<span class="number">31</span>:*.sar=<span class="number">01</span>;<span class="number">31</span>:*.rar=<span class="number">01</span>;<span class="number">31</span>:*.alz=<span class="number">01</span>;<span class="number">31</span>:*.ace=<span class="number">01</span>;<span class="number">31</span>:*.zoo=<span class="number">01</span>;<span class="number">31</span>:*.cpio=<span class="number">01</span>;<span class="number">31</span>:*<span class="number">.7</span>z=<span class="number">01</span>;<span class="number">31</span>:*.rz=<span class="number">01</span>;<span class="number">31</span>:*.cab=<span class="number">01</span>;<span class="number">31</span>:*.jpg=<span class="number">01</span>;<span class="number">35</span>:*.jpeg=<span class="number">01</span>;<span class="number">35</span>:*.gif=<span class="number">01</span>;<span class="number">35</span>:*.bmp=<span class="number">01</span>;<span class="number">35</span>:*.pbm=<span class="number">01</span>;<span class="number">35</span>:*.pgm=<span class="number">01</span>;<span class="number">35</span>:*.ppm=<span class="number">01</span>;<span class="number">35</span>:*.tga=<span class="number">01</span>;<span class="number">35</span>:*.xbm=<span class="number">01</span>;<span class="number">35</span>:*.xpm=<span class="number">01</span>;<span class="number">35</span>:*.tif=<span class="number">01</span>;<span class="number">35</span>:*.tiff=<span class="number">01</span>;<span class="number">35</span>:*.png=<span class="number">01</span>;<span class="number">35</span>:*.svg=<span class="number">01</span>;<span class="number">35</span>:*.svgz=<span class="number">01</span>;<span class="number">35</span>:*.mng=<span class="number">01</span>;<span class="number">35</span>:*.pcx=<span class="number">01</span>;<span class="number">35</span>:*.mov=<span class="number">01</span>;<span class="number">35</span>:*.mpg=<span class="number">01</span>;<span class="number">35</span>:*.mpeg=<span class="number">01</span>;<span class="number">35</span>:*.m2v=<span class="number">01</span>;<span class="number">35</span>:*.mkv=<span class="number">01</span>;<span class="number">35</span>:*.webm=<span class="number">01</span>;<span class="number">35</span>:*.ogm=<span class="number">01</span>;<span class="number">35</span>:*.mp4=<span class="number">01</span>;<span class="number">35</span>:*.m4v=<span class="number">01</span>;<span class="number">35</span>:*.mp4v=<span class="number">01</span>;<span class="number">35</span>:*.vob=<span class="number">01</span>;<span class="number">35</span>:*.qt=<span class="number">01</span>;<span class="number">35</span>:*.nuv=<span class="number">01</span>;<span class="number">35</span>:*.wmv=<span class="number">01</span>;<span class="number">35</span>:*.asf=<span class="number">01</span>;<span class="number">35</span>:*.rm=<span class="number">01</span>;<span class="number">35</span>:*.rmvb=<span class="number">01</span>;<span class="number">35</span>:*.flc=<span class="number">01</span>;<span class="number">35</span>:*.avi=<span class="number">01</span>;<span class="number">35</span>:*.fli=<span class="number">01</span>;<span class="number">35</span>:*.flv=<span class="number">01</span>;<span class="number">35</span>:*.gl=<span class="number">01</span>;<span class="number">35</span>:*.dl=<span class="number">01</span>;<span class="number">35</span>:*.xcf=<span class="number">01</span>;<span class="number">35</span>:*.xwd=<span class="number">01</span>;<span class="number">35</span>:*.yuv=<span class="number">01</span>;<span class="number">35</span>:*.cgm=<span class="number">01</span>;<span class="number">35</span>:*.emf=<span class="number">01</span>;<span class="number">35</span>:*.axv=<span class="number">01</span>;<span class="number">35</span>:*.anx=<span class="number">01</span>;<span class="number">35</span>:*.ogv=<span class="number">01</span>;<span class="number">35</span>:*.ogx=<span class="number">01</span>;<span class="number">35</span>:*.aac=<span class="number">01</span>;<span class="number">36</span>:*.au=<span class="number">01</span>;<span class="number">36</span>:*.flac=<span class="number">01</span>;<span class="number">36</span>:*.mid=<span class="number">01</span>;<span class="number">36</span>:*.midi=<span class="number">01</span>;<span class="number">36</span>:*.mka=<span class="number">01</span>;<span class="number">36</span>:*.mp3=<span class="number">01</span>;<span class="number">36</span>:*.mpc=<span class="number">01</span>;<span class="number">36</span>:*.ogg=<span class="number">01</span>;<span class="number">36</span>:*.ra=<span class="number">01</span>;<span class="number">36</span>:*.wav=<span class="number">01</span>;<span class="number">36</span>:*.axa=<span class="number">01</span>;<span class="number">36</span>:*.oga=<span class="number">01</span>;<span class="number">36</span>:*.spx=<span class="number">01</span>;<span class="number">36</span>:*.xspf=<span class="number">01</span>;<span class="number">36</span>:</span><br><span class="line">MAIL=/var/spool/mail/root</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span><br><span class="line">PWD=/linux/lesson7</span><br><span class="line">LANG=en_US.UTF<span class="number">-8</span></span><br><span class="line">HISTCONTROL=ignoredups</span><br><span class="line">SHLVL=<span class="number">1</span></span><br><span class="line">HOME=/root</span><br><span class="line">LOGNAME=root</span><br><span class="line">SSH_CONNECTION=<span class="number">120.203</span><span class="number">.222</span><span class="number">.148</span> <span class="number">24491</span> <span class="number">198.13</span><span class="number">.33</span><span class="number">.7</span> <span class="number">22</span></span><br><span class="line">LESSOPEN=||/usr/bin/lesspipe.sh %s</span><br><span class="line">XDG_RUNTIME_DIR=/run/user/<span class="number">0</span></span><br><span class="line">_=./environ</span><br></pre></td></tr></table></figure>
<h4 id="getenv-putenv"><a href="#getenv-putenv" class="headerlink" title="getenv() putenv()"></a>getenv() putenv()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">extern</span> <span class="keyword">char</span> **environ;</span><br><span class="line">    <span class="keyword">char</span>** env=environ;</span><br><span class="line">    <span class="keyword">while</span>(*env)</span><br><span class="line">    &#123;</span><br><span class="line"><span class="comment">//        printf("%s\n",*env);</span></span><br><span class="line">        env++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span>* buf=(<span class="keyword">char</span>*)<span class="built_in">malloc</span>(<span class="number">100</span>);</span><br><span class="line">    buf = getenv(<span class="string">"hero"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"hero=%s\n"</span>,buf);</span><br><span class="line">    <span class="keyword">if</span>(putenv(<span class="string">"hero=vn"</span>)!=<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"putenv error\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    buf = getenv(<span class="string">"hero"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"hero=%s\n"</span>,buf);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@vultr lesson7]# ./environ</span><br><span class="line">hero=(null)</span><br><span class="line">hero=vn</span><br></pre></td></tr></table></figure>
<p>getenv()不能设置全局环境变量，只是该进程独享</p>
<h4 id="setenv-unsetenv"><a href="#setenv-unsetenv" class="headerlink" title="setenv() unsetenv()"></a>setenv() unsetenv()</h4><h4 id="exit-exit"><a href="#exit-exit" class="headerlink" title="exit() _exit()"></a>exit() _exit()</h4><h4 id="atexit"><a href="#atexit" class="headerlink" title="atexit()"></a>atexit()</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">fun_1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"clean function fun_1 running\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">fun_2</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">"clean function fun_2 running\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    atexit(fun_1);</span><br><span class="line">    <span class="built_in">abort</span>();</span><br><span class="line">    atexit(fun_2);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"main:exit normally\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@vultr lesson7]# ./atexit</span><br><span class="line">Aborted</span><br><span class="line">[root@vultr lesson7]<span class="meta"># ls -ai</span></span><br><span class="line"><span class="number">384031</span> .   <span class="number">384032</span> arg    <span class="number">384039</span> atexit    <span class="number">384036</span> environ    <span class="number">384033</span> getopt    <span class="number">384035</span> test</span><br><span class="line"><span class="number">384001</span> ..  <span class="number">384034</span> arg.c  <span class="number">384040</span> atexit.c  <span class="number">384041</span> environ.c  <span class="number">384037</span> getopt.c  <span class="number">384038</span> test.c</span><br></pre></td></tr></table></figure>
<p>运行该程序之后，没有生成按理来说应该有的core文件，这是因为系统默认core文件大小为0，所以没有创建。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@vultr lesson7]<span class="meta"># ulimit -c</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line">[root@vultr lesson7]<span class="meta"># ulimit -c 1000</span></span><br><span class="line">[root@vultr lesson7]# ./atexit</span><br><span class="line">Aborted (core dumped)</span><br><span class="line">[root@vultr lesson7]<span class="meta"># ls -ai</span></span><br><span class="line"><span class="number">384031</span> .   <span class="number">384032</span> arg    <span class="number">384039</span> atexit    <span class="number">384042</span> core<span class="number">.19820</span>  <span class="number">384041</span> environ.c  <span class="number">384037</span> getopt.c  <span class="number">384038</span> test.c</span><br><span class="line"><span class="number">384001</span> ..  <span class="number">384034</span> arg.c  <span class="number">384040</span> atexit.c  <span class="number">384036</span> environ     <span class="number">384033</span> getopt     <span class="number">384035</span> test</span><br></pre></td></tr></table></figure></p>
<h3 id="setjump"><a href="#setjump" class="headerlink" title="setjump()"></a>setjump()</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;setjmp.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">jmp_buf buf;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"test running\n"</span>);</span><br><span class="line">    longjmp(buf,<span class="number">1</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"test end\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> tim=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(setjmp(buf))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"back in main\n"</span>);</span><br><span class="line">        tim++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"first time\n"</span>);</span><br><span class="line">        test();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(tim&lt;<span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        longjmp(buf,<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@vultr lesson7]<span class="meta"># gcc setjump.c -o setjump</span></span><br><span class="line">[root@vultr lesson7]# ./setjump</span><br><span class="line">first time</span><br><span class="line">test running</span><br><span class="line">back in main</span><br><span class="line">back in main</span><br><span class="line">back in main</span><br></pre></td></tr></table></figure>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        <li title="0" data-url="http://link.hhtjim.com/qq/001faIUs4M2zna.mp3"></li>
                    
                        <li title="1" data-url="http://link.hhtjim.com/qq/001faIUs4M2zna.mp3"></li>
                    
                </ul>
            
        </div>
        
    <div id="gitalk-container" class="comment link" data-ae="false" data-ci="" data-cs="" data-r="" data-o="" data-a="" data-d="false">查看评论</div>


    </div>
    
</div>


    </div>
</div>
</body>
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/diaspora.js"></script>
<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">
<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>

<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>




</html>